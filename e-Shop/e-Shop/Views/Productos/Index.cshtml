@model IEnumerable<e_Shop.Models.ProductoModel>

@{
    ViewBag.Title = "Index";
    string idUsuario;
    bool val1 = System.Web.HttpContext.Current.User.Identity.IsAuthenticated;
    if (val1)
    {
        idUsuario = System.Web.HttpContext.Current.User.Identity.Name;
    }
    else
    {
        if (Session["tokenSession"] == null)
        {
            Session["tokenSession"] = Guid.NewGuid().ToString();
        }
        idUsuario = Session["tokenSession"].ToString();
    }
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Agregar producto", "Crear")
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Codigo)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Nombre)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Categoria)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Precio)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Descripcion)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Codigo)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Nombre)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Categoria)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Precio)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Descripcion)
        </td>
        <td>
            <button onclick="agregar('@item.Codigo')">+</button>
            @Html.ActionLink("Delete", "Delete", new { id=item.Codigo  })
        </td>
    </tr>
}

</table>

<script type="text/javascript">
    alert("Token: @idUsuario");
    function agregar(codigo) {
        alert(codigo);
        $.ajax({
            //La url de tu API
            url: "/Carrito/agregar",
            //tipo POST o GET
            type : "POST",
            //Aqui se especifica el tipo de datos a enviar
            contentType: 'application/json',
            //Aqui van los datos a enviar dependiendo el tipo (Json en este caso)
            data : {
                "id": "@Guid.NewGuid().ToString()" ,
                "idCarrito": "@idUsuario" ,
                "productoId":codigo,
                "cantidad": 1
            },
            //Aqui es cuando recibes el status 200 y data es lo que recibes del servidor
            success: function(data){
                window.location.replace("/Carrito/Index");
            },
            //Cuando el servidor regresa un error
            error : function(xhr, status) {
                alert("¡Hubo un error al agregar!");
            }
        });
    }
</script>